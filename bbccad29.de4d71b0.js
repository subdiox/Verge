(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{165:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return c})),a.d(t,"metadata",(function(){return o})),a.d(t,"rightToc",(function(){return s})),a.d(t,"default",(function(){return p}));var n=a(2),r=a(9),i=(a(0),a(171)),c={id:"dispatcher",title:"Dispatcher - performs a mutation from away the store",sidebar_label:"Dispatcher",description:"Dispatcher allows us to update the state of the Store from away the store and to manage dependencies to create Mutation.\n"},o={id:"VergeStore/dispatcher",isDocsHomePage:!1,title:"Dispatcher - performs a mutation from away the store",description:"Dispatcher allows us to update the state of the Store from away the store and to manage dependencies to create Mutation.\n",source:"@site/docs/VergeStore/dispatcher.md",permalink:"/Verge/docs/VergeStore/dispatcher",editUrl:"https://github.com/VergeGroup/Verge/docs/docs/VergeStore/dispatcher.md",sidebar_label:"Dispatcher",sidebar:"docs",previous:{title:"Derived / BindingDerived - derives a any shape value from the state",permalink:"/Verge/docs/VergeStore/derived"},next:{title:"Logging",permalink:"/Verge/docs/VergeStore/logging"}},s=[{value:"Define a dispatcher",id:"define-a-dispatcher",children:[]},{value:"Add an action to the dispatcher",id:"add-an-action-to-the-dispatcher",children:[]},{value:"Add a dependency to dispatch an action",id:"add-a-dependency-to-dispatch-an-action",children:[]},{value:"Create multiple Dispatcher",id:"create-multiple-dispatcher",children:[]},{value:"Create scoped dispatcher",id:"create-scoped-dispatcher",children:[{value:"Detaching to other tree",id:"detaching-to-other-tree",children:[]}]}],l={rightToc:s};function p(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(n.a)({},l,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"Dispatcher allows us to update the state of the Store from away the store and to manage dependencies to create Mutation."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Dispatcher is",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"it is an object."),Object(i.b)("li",{parentName:"ul"},"it does not have its own state."),Object(i.b)("li",{parentName:"ul"},"it can run commit with specified store's state."),Object(i.b)("li",{parentName:"ul"},"it can have a temporary dependency to commit the mutation."),Object(i.b)("li",{parentName:"ul"},"it can focus on specified tree of the state.")))),Object(i.b)("p",null,"Here is an example store, in this section we create a dispatcher to commit the mutation into this Store:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-swift"}),"struct State: StateType {\n  var count: Int = 0\n}\n\nenum Activity {\n  case happen\n}\n\nfinal class MyStore: Store<State, Activity> {\n  ...\n}\n")),Object(i.b)("p",null,"MyStore has a typealias to define a dispatcher:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-swift"}),"MyStore.Dispatcher\n")),Object(i.b)("div",{className:"admonition admonition-info alert alert--info"},Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"Actual type of MyStore.Dispatcher is DispatcherBase<State, Never> It is a typealias to write shortly."))),Object(i.b)("h2",{id:"define-a-dispatcher"},"Define a dispatcher"),Object(i.b)("p",null,"Let's take a look how we create a dispatcher with using the typealias:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-swift",metastring:"{1}","{1}":!0}),"final class MyDispatcher: MyStore.Dispatcher {\n\n}\n")),Object(i.b)("p",null,"Now we can create an instance of ",Object(i.b)("inlineCode",{parentName:"p"},"MyDispatcher"),":"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-swift"}),"let store = MyStore()\nlet dispatcher = MyDispatcher(targetStore: store)\n")),Object(i.b)("h2",{id:"add-an-action-to-the-dispatcher"},"Add an action to the dispatcher"),Object(i.b)("p",null,"Next, we add an action that commits a mutation:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-swift"}),"final class MyDispatcher: MyStore.Dispatcher {\n  func doSomething() {\n    commit {\n      $0.count = 100\n    }\n  }\n}\n")),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-swift",metastring:"{4,6}","{4,6}":!0}),"let store: MyStore\nlet dispatcher: MyDispatcher\n\ndispatcher.doSomething()\n\nstore.state.count == 100 // true\n")),Object(i.b)("h2",{id:"add-a-dependency-to-dispatch-an-action"},"Add a dependency to dispatch an action"),Object(i.b)("p",null,"In the case of large applications, we need to handle many dependencies to run the application.",Object(i.b)("br",{parentName:"p"}),"\n","For example, if we use multiple HTTP clients."),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-swift"}),"final class MyDispatcher: MyStore.Dispatcher {\n\n  let apiClient: APIClient\n\n  init(apiClient: APIClient, targetStore: Store<RootState>) {\n    self.apiClient = apiClient\n    super.init(targetStore: targetStore)\n  }\n\n  // an example of fetching data and commit\n  func fetchData() {\n    apiClient.fetchData { [weak self] result in\n      switch result {\n      case .success(let data):\n        let items = data.encode(...)\n        self?.commit {\n          $0.fetchedItems = items\n        }\n      case .failure(let error):\n      // handles error\n      }\n    }\n  }\n}\n")),Object(i.b)("p",null,"To use this:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-swift"}),"let store = MyStore()\nlet apiClient = APIClient()\nlet dispatcher = MyDispatcher(apiClient: apiClient, target: store)\n\ndispatcher.fetchData()\n")),Object(i.b)("p",null,"Now we can handle multiple kinds of dependencies each it fits itself life-time.",Object(i.b)("br",{parentName:"p"}),"\n","For example, if you have a restriction that some dependencies can be created only the user's logging-in, you can create a dispatcher what is for."),Object(i.b)("p",null,"Next section explains the detail."),Object(i.b)("h2",{id:"create-multiple-dispatcher"},"Create multiple Dispatcher"),Object(i.b)("p",null,Object(i.b)("img",Object(n.a)({parentName:"p"},{src:"https://user-images.githubusercontent.com/1888355/82821486-28586a00-9edf-11ea-8c98-062eafcc4f16.png",alt:"image"}))),Object(i.b)("p",null,"Creating a dispatcher does not have the restriction of the number of instances or types.",Object(i.b)("br",{parentName:"p"}),"\n","This means that it allows us to define a dispatcher and instantiate an instance of the dispatcher to fill the use-case."),Object(i.b)("p",null,"For example, In case the timing of getting dependencies that to be needed by run Action or Mutation is different, it's not easy to have them in the one dispatcher with type-safety. they must be optional types."),Object(i.b)("p",null,"Using creating multiple dispatchers techniques solves this case by defines the dispatcher each the timing of getting dependencies."),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-swift"}),"class LoggedInDispatcher: MyStore.Dispatcher {\n\n  let apiClientNeedsAuthToken: APIClient = ...\n  ...\n}\n\nclass LoggedOutDispatcher: MyStore.Dispatcher {\n\n  let apiClientWithoutAuthToken: APIClient = ...\n  ...\n}\n")),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-swift"}),"let store = MyStore()\nlet loggedInDispatcher = LoggedInDispatcher(...)\nlet loggedOutDispatcher = LoggedOutDispatcher(...)\n")),Object(i.b)("p",null,"The application will create ",Object(i.b)("inlineCode",{parentName:"p"},"LoggedInDispatcher")," when the user is logged-in and deinitialize ",Object(i.b)("inlineCode",{parentName:"p"},"LoggedOutDispatcher"),"."),Object(i.b)("h2",{id:"create-scoped-dispatcher"},"Create scoped dispatcher"),Object(i.b)("p",null,"As another feature what Dispatcher provides,\nIt supports to commit specified scope of the state which helps to mutate with focus on a part of the large state tree."),Object(i.b)("p",null,"Here is a sample state that assuming a large app."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"AppState (MyStore)",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"db: Database"),Object(i.b)("li",{parentName:"ul"},"loggedIn: LoggedInState",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"myInfo: MyInfoState"))),Object(i.b)("li",{parentName:"ul"},"loggedOut: LoggedOutState")))),Object(i.b)("p",null,"We have ",Object(i.b)("inlineCode",{parentName:"p"},"database"),", ",Object(i.b)("inlineCode",{parentName:"p"},"logged-in")," and ",Object(i.b)("inlineCode",{parentName:"p"},"logged-out state"),".\n",Object(i.b)("inlineCode",{parentName:"p"},"database")," means normalized state shape to manage many entities."),Object(i.b)("p",null,"In previous section, that explained we can multiple dispatchers each the user's state.",Object(i.b)("br",{parentName:"p"}),"\n","However, it needs to the full path to mutate where we need to mutate."),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-swift"}),"class LoggedInDispatcher: MyStore.Dispatcher {\n\n  func performA() {\n    commit {\n      $0.loggedIn.xxx\n    }\n  }\n\n  func performB() {\n    commit {\n      $0.loggedIn.xxx\n    }\n  }\n\n  func performC() {\n    commit {\n      $0.loggedIn.xxx\n    }\n  }\n}\n")),Object(i.b)("p",null,"LoggedInDispatcher will often dispatch some action for logged-in-state.",Object(i.b)("br",{parentName:"p"}),"\n","But it calls everytime ",Object(i.b)("inlineCode",{parentName:"p"},"$0.loggedIn"),", it seems a little bit verbosity."),Object(i.b)("p",null,"That will be solved by ",Object(i.b)("inlineCode",{parentName:"p"},"ScopedDispatcher"),".\nIt will move on target tree of the state when it dispatch the action."),Object(i.b)("p",null,"The following code shows how we could create a ",Object(i.b)("inlineCode",{parentName:"p"},"ScopedDispatcher"),":"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-swift"}),"final class LoggedInService: MyStore.ScopedDispatcher<LoggedInState> {\n\n  init(store: Store) {\n    super.init(targetStore: store, scope: \\.loggedIn)\n  }\n\n  func someOperation() {\n    commit { (state: LoggedInState) in\n      ...\n    }\n  }\n}\n")),Object(i.b)("p",null,"In LoggedInService, commit mutates ",Object(i.b)("inlineCode",{parentName:"p"},"LoggedInState")," directly.\nLike this, we can create a dispatcher each use-cases."),Object(i.b)("h3",{id:"detaching-to-other-tree"},"Detaching to other tree"),Object(i.b)("p",null,"Just in case, ",Object(i.b)("inlineCode",{parentName:"p"},"ScopedDispatcher")," supports also mutating on other state tree."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Moving on more deeper")),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-swift"}),"final class LoggedInService: MyStore.ScopedDispatcher<LoggedInState> {\n\n  func detachingOperation() {\n    let myInfo = detached(by: \\.myInfo)\n    myInfo.commit { (state: MyInfo) in\n\n    }\n  }\n}\n")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Detaches from root")),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-swift"}),"final class LoggedInService: MyStore.ScopedDispatcher<LoggedInState> {\n\n  func detachingOperation() {\n    let db = detached(from: \\.db)\n    db.commit { (state: Database) in\n\n    }\n  }\n}\n")))}p.isMDXComponent=!0},171:function(e,t,a){"use strict";a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return u}));var n=a(0),r=a.n(n);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},h=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=p(a),h=n,u=d["".concat(c,".").concat(h)]||d[h]||b[h]||i;return a?r.a.createElement(u,o(o({ref:t},l),{},{components:a})):r.a.createElement(u,o({ref:t},l))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,c=new Array(i);c[0]=h;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:n,c[1]=o;for(var l=2;l<i;l++)c[l]=a[l];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,a)}h.displayName="MDXCreateElement"}}]);