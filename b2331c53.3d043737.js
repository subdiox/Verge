(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{161:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return o})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return l}));var a=n(2),i=n(9),c=(n(0),n(170)),r={id:"BasicUsage",title:"Basic Usage",sidebar_label:"Basic Usage"},o={id:"VergeStore/BasicUsage",isDocsHomePage:!1,title:"Basic Usage",description:"This section shows you how we start to use Verge.",source:"@site/docs/VergeStore/BasicUsage.md",permalink:"/Verge/docs/VergeStore/BasicUsage",editUrl:"https://github.com/VergeGroup/Verge/docs/docs/VergeStore/BasicUsage.md",sidebar_label:"Basic Usage",sidebar:"docs",previous:{title:"Demo",permalink:"/Verge/docs/demo"},next:{title:"Advanced usage",permalink:"/Verge/docs/VergeStore/advanced-usage"}},s=[{value:"Domains",id:"domains",children:[{value:"Store",id:"store",children:[]},{value:"State",id:"state",children:[]},{value:"Activity",id:"activity",children:[]},{value:"Action",id:"action",children:[]},{value:"Dispatcher (Optional)",id:"dispatcher-optional",children:[]}]},{value:"Setup a Store",id:"setup-a-store",children:[{value:"Define a state",id:"define-a-state",children:[]},{value:"Define an activity",id:"define-an-activity",children:[]},{value:"Define a store",id:"define-a-store",children:[]}]},{value:"Add an action",id:"add-an-action",children:[{value:"Run the action",id:"run-the-action",children:[]}]},{value:"Send an activity from the action",id:"send-an-activity-from-the-action",children:[]},{value:"Binding the state with UI",id:"binding-the-state-with-ui",children:[{value:"Use the store in SwiftUI",id:"use-the-store-in-swiftui",children:[]},{value:"Use the store in UIKit",id:"use-the-store-in-uikit",children:[]}]}],b={rightToc:s};function l(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(c.b)("wrapper",Object(a.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(c.b)("p",null,"This section shows you how we start to use Verge.",Object(c.b)("br",{parentName:"p"}),"\n","It's very basic usage. You need to read Advanced Usage section if you're considering to use in production."),Object(c.b)("p",null,"To understand smoothly about Verge, we need to figure the following domains out."),Object(c.b)("h2",{id:"domains"},"Domains"),Object(c.b)("h3",{id:"store"},"Store"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"A storage object to manage a state and emit activities by the action."),Object(c.b)("li",{parentName:"ul"},"Store can dispatch actions to itself.")),Object(c.b)("h3",{id:"state"},"State"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"A type of state-tree that describes the data our feature needs.")),Object(c.b)("h3",{id:"activity"},"Activity"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"A type that describes an activity that happens during performs the action."),Object(c.b)("li",{parentName:"ul"},"This instance won't be stored in anywhere. It would help us to perform something by event-driven."),Object(c.b)("li",{parentName:"ul"},"Consider to use this depends on that if can be represented as a state."),Object(c.b)("li",{parentName:"ul"},"For example, to present alert or notifcitaions by the action.")),Object(c.b)("h3",{id:"action"},"Action"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"Action runs any operations (sync / async) and commits any mutations to the state of the store."),Object(c.b)("li",{parentName:"ul"},"Action is described by Swift's method in Store or Dispatcher.")),Object(c.b)("h3",{id:"dispatcher-optional"},"Dispatcher (Optional)"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"A type to dispatch an action to specific store."),Object(c.b)("li",{parentName:"ul"},"For a large application, to separate the logics each domain.")),Object(c.b)("h2",{id:"setup-a-store"},"Setup a Store"),Object(c.b)("h3",{id:"define-a-state"},"Define a state"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-swift"}),"struct MyState {\n  var count = 0\n}\n")),Object(c.b)("h3",{id:"define-an-activity"},"Define an activity"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-swift"}),"enum MyActivity {\n  case countWasIncremented\n}\n")),Object(c.b)("div",{className:"admonition admonition-info alert alert--info"},Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(c.b)("h5",{parentName:"div"},Object(c.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(c.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(c.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(c.b)("p",{parentName:"div"},Object(c.b)("inlineCode",{parentName:"p"},"Activity")," is not required type.",Object(c.b)("br",{parentName:"p"}),"\n","If you don't need to use ",Object(c.b)("inlineCode",{parentName:"p"},"Activity"),", you can set",Object(c.b)("inlineCode",{parentName:"p"},"Never")," in Store's type parameter."))),Object(c.b)("h3",{id:"define-a-store"},"Define a store"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-swift"}),"class MyStore: Store<MyState, MyActivity> {\n\n  init(dependency: Dependency) {\n    super.init(initialState: .init(), logger: nil)\n  }\n\n}\n")),Object(c.b)("p",null,"In example, it created a subclass of ",Object(c.b)("inlineCode",{parentName:"p"},"Store"),". Of course, we can also create an instance from ",Object(c.b)("inlineCode",{parentName:"p"},"Store")," without subclassing.",Object(c.b)("br",{parentName:"p"}),"\n","But we can put some dependencies (e.g. API client) with creating a sub-class of ",Object(c.b)("inlineCode",{parentName:"p"},"Store"),"."),Object(c.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(c.b)("h5",{parentName:"div"},Object(c.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(c.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(c.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"When don't use Activity")),Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(c.b)("pre",{parentName:"div"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-swift",metastring:"{1}","{1}":!0}),"class MyStore: Store<MyState, Never> {\n\n}\n")))),Object(c.b)("h2",{id:"add-an-action"},"Add an action"),Object(c.b)("p",null,"Next, add an action to mutate the state.\nEssentially, Verge uses Swift's method to describe an action against enum or struct based action descriptor other Flux library has.\nThis approach has advantages that adding an action faster and call it naturally and dispatches with a faster way by Swift's native method dispatching system."),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"Better Performance"),Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},"Swift can perform this action with Swift's method dispatching instead switch-case computing."))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"Returns anything we need"),Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},"the action can return anything from that action (e.g. state or result)"),Object(c.b)("li",{parentName:"ul"},"If that action dispatch async operation, it can return ",Object(c.b)("inlineCode",{parentName:"li"},"Future")," object. (such as Vuex action)")))),Object(c.b)("p",null,"As a future direction, Verge might get a dispatching action system with describing with enum or struct based to run action.",Object(c.b)("br",{parentName:"p"}),"\n","However, the current approach would be the base system for it."),Object(c.b)("p",null,"We're currently researching that needs."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-swift",metastring:"{3-7}","{3-7}":!0}),"class MyStore: Store<MyState, MyActivity> {\n\n  func incrementCount() {\n    commit {\n      $0.count += 1\n    }\n  }\n\n}\n")),Object(c.b)("p",null,"Yes, this point is most different with Redux. we could say it close to Vuex.",Object(c.b)("br",null),"\nStore knows what the application's needs."),Object(c.b)("p",null,"To mutate the state, we use ",Object(c.b)("inlineCode",{parentName:"p"},"commit")," method.",Object(c.b)("br",{parentName:"p"}),"\n","the argument inside commit's closure is ",Object(c.b)("inlineCode",{parentName:"p"},"inout State"),", you can modify it anything but you can't put the asynchronous operations.",Object(c.b)("br",{parentName:"p"}),"\n","If you need to do this, call ",Object(c.b)("inlineCode",{parentName:"p"},"commit")," from the asynchronous operation. like this:"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-swift"}),"func incrementCount() {\n  DispatchQueue.main.async {\n    commit {\n      $0.count += 1\n    }\n  }\n}\n")),Object(c.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(c.b)("h5",{parentName:"div"},Object(c.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(c.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(c.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"You can define actions aware from the Store")),Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(c.b)("p",{parentName:"div"},"Using ",Object(c.b)("inlineCode",{parentName:"p"},"Dispatcher"),", you can manage the set of actions aware from the store."))),Object(c.b)("h3",{id:"run-the-action"},"Run the action"),Object(c.b)("p",null,"For example, call that action."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-swift"}),"let store = MyStore(...)\nstore.incrementCount()\n")),Object(c.b)("h2",{id:"send-an-activity-from-the-action"},"Send an activity from the action"),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-swift"}),"func incrementCount() {\n  ...\n  send(.countWasIncremented)\n}\n")),Object(c.b)("h2",{id:"binding-the-state-with-ui"},"Binding the state with UI"),Object(c.b)("h3",{id:"use-the-store-in-swiftui"},"Use the store in SwiftUI"),Object(c.b)("p",null,"To bind the state with ",Object(c.b)("inlineCode",{parentName:"p"},"View"),", it uses ",Object(c.b)("inlineCode",{parentName:"p"},"UseState"),".",Object(c.b)("br",{parentName:"p"}),"\n","Since ",Object(c.b)("inlineCode",{parentName:"p"},"Store")," is also compatible with ",Object(c.b)("inlineCode",{parentName:"p"},"ObservableObject"),", we can declare ",Object(c.b)("inlineCode",{parentName:"p"},"@ObservedObject")," or ",Object(c.b)("inlineCode",{parentName:"p"},"@EnviromentObject"),"."),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"UseState")," provides several options to reduce no changes updates.",Object(c.b)("br",{parentName:"p"}),"\n","Please check it out from Xcode."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-swift"}),"struct MyView: View {\n\n  let store: MyStore\n\n  var body: some View {\n    UseState { state in\n      Text(state.name)\n    }\n    .onReceive(session.store.activityPublisher) { (activity) in\n      ...\n    }\n  }\n}\n")),Object(c.b)("h3",{id:"use-the-store-in-uikit"},"Use the store in UIKit"),Object(c.b)("p",null,"In UIKit, UIKit doesn't work with differentiating.",Object(c.b)("br",{parentName:"p"}),"\n","To keep better performance, we need to set a value if it's changed."),Object(c.b)("p",null,"Verge publishes an object that contains previous state and latest state, ",Object(c.b)("inlineCode",{parentName:"p"},"Changes")," object would be so helpful to check if a value changed."),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-swift"}),"class ViewController: UIViewController {\n\n  let store: MyStore\n\n  var cancellable: VergeAnyCancellable?\n\n  init(store: MyStore) {\n    ...\n\n    self.cancellable = store.sinkChanges { [weak self] changes in\n      self?.update(changes: changes)\n    }\n\n  }\n\n  private func update(changes: Changes<MyStore.State>) {\n\n    changes.ifChanged(\\.name) { (name) in\n      nameLabel.text = name\n    }\n\n    changes.ifChanged(\\.age) { (age) in\n      ageLabel.text = age.description\n    }\n\n  }\n}\n")))}l.isMDXComponent=!0},170:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return m}));var a=n(0),i=n.n(a);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},c=Object.keys(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var b=i.a.createContext({}),l=function(e){var t=i.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=l(e.components);return i.a.createElement(b.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},u=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,c=e.originalType,r=e.parentName,b=s(e,["components","mdxType","originalType","parentName"]),d=l(n),u=a,m=d["".concat(r,".").concat(u)]||d[u]||p[u]||c;return n?i.a.createElement(m,o(o({ref:t},b),{},{components:n})):i.a.createElement(m,o({ref:t},b))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var c=n.length,r=new Array(c);r[0]=u;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:a,r[1]=o;for(var b=2;b<c;b++)r[b]=n[b];return i.a.createElement.apply(null,r)}return i.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);